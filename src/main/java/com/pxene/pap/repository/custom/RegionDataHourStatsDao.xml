<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pxene.pap.repository.custom.RegionDataHourStatsDao">

	<select id="selectByCampaignId" resultType="java.util.Map">
		SELECT
			t.region_id regionId,
			t.campaign_id campaignId,
			IFNULL(SUM(t.bid_amount),0) AS bidAmount,
			IFNULL(SUM(t.win_amount),0) AS winAmount,
			IFNULL(SUM(t.win_amount)/SUM(t.bid_amount),0) AS winRate,
			IFNULL(SUM(t.impression_amount),0) AS impressionAmount,
			IFNULL(SUM(t.impression_amount)/SUM(t.win_amount),0) AS impressionRate,
			IFNULL(SUM(t.click_amount),0) AS clickAmount,
			IFNULL(SUM(t.click_amount)/SUM(t.impression_amount),0) AS clickRate,
			IFNULL(SUM(t.arrival_amount),0) AS arrivalAmount,
			IFNULL(SUM(t.arrival_amount)/SUM(t.click_amount),0) AS arrivalRate,
			IFNULL(SUM(t.unique_amount),0) AS uniqueAmount,
			IFNULL(round(avg(t.resident_time)),0) as residentTime,
			IFNULL(SUM(t.jump_amount),0) AS jumpAmount,
			ifnull(SUM(t.jump_amount)/SUM(t.arrival_amount),0) AS jumpRate
		FROM
			pap_t_regiondata_hour t
		WHERE
			t.campaign_id = #{campaignId, jdbcType=VARCHAR}
		AND
			t.datetime BETWEEN #{startTime, jdbcType=TIMESTAMP} AND #{endTime, jdbcType=TIMESTAMP}
		GROUP BY
			t.region_id
	</select>
</mapper>